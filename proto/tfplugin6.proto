// Terraform Plugin Protocol v6
// This is a simplified version of the Terraform plugin protocol

syntax = "proto3";

package tfplugin6;

option go_package = "github.com/hashicorp/terraform/internal/tfplugin6";

// DynamicValue is the wire format for Terraform values
message DynamicValue {
    bytes msgpack = 1;
    bytes json = 2;
}

// Diagnostic is a message for reporting problems
message Diagnostic {
    enum Severity {
        INVALID = 0;
        ERROR = 1;
        WARNING = 2;
    }
    Severity severity = 1;
    string summary = 2;
    string detail = 3;
    AttributePath attribute = 4;
}

// AttributePath is a path to a nested attribute
message AttributePath {
    message Step {
        oneof selector {
            string attribute_name = 1;
            int64 element_key_int = 2;
            string element_key_string = 3;
        }
    }
    repeated Step steps = 1;
}

// StopProvider
message StopProvider {
    message Request {
    }
    message Response {
        string error = 1;
    }
}

// RawState is raw state data
message RawState {
    bytes json = 1;
    map<string, string> flatmap = 2;
}

// Schema describes the schema for a resource, data source, or provider
message Schema {
    message Block {
        int64 version = 1;
        repeated Attribute attributes = 2;
        repeated NestedBlock block_types = 3;
        string description = 4;
        StringKind description_kind = 5;
        bool deprecated = 6;
    }

    message Attribute {
        string name = 1;
        bytes type = 2;
        Object nested_type = 3;
        string description = 4;
        StringKind description_kind = 5;
        bool required = 6;
        bool optional = 7;
        bool computed = 8;
        bool sensitive = 9;
        bool deprecated = 10;
    }

    message NestedBlock {
        enum NestingMode {
            INVALID = 0;
            SINGLE = 1;
            LIST = 2;
            SET = 3;
            MAP = 4;
            GROUP = 5;
        }

        string type_name = 1;
        Block block = 2;
        NestingMode nesting = 3;
        int64 min_items = 4;
        int64 max_items = 5;
    }

    message Object {
        enum NestingMode {
            INVALID = 0;
            SINGLE = 1;
            LIST = 2;
            SET = 3;
            MAP = 4;
        }

        repeated Attribute attributes = 1;
        NestingMode nesting = 2;
        int64 min_items = 3;
        int64 max_items = 4;
    }

    enum StringKind {
        PLAIN = 0;
        MARKDOWN = 1;
    }

    int64 version = 1;
    Block block = 2;
}

// Function defines a provider function
message Function {
    message Parameter {
        string name = 1;
        bytes type = 2;
        bool allow_null_value = 3;
        bool allow_unknown_value = 4;
        string description = 5;
        StringKind description_kind = 6;
    }

    message Return {
        bytes type = 1;
    }

    enum StringKind {
        PLAIN = 0;
        MARKDOWN = 1;
    }

    repeated Parameter parameters = 1;
    Parameter variadic_parameter = 2;
    Return return = 3;
    string summary = 4;
    string description = 5;
    StringKind description_kind = 6;
    bool deprecation_message = 7;
}

// Deferred is used for deferred actions
message Deferred {
    enum Reason {
        UNKNOWN = 0;
        RESOURCE_CONFIG_UNKNOWN = 1;
        PROVIDER_CONFIG_UNKNOWN = 2;
        ABSENT_PREREQ = 3;
    }
    Reason reason = 1;
}

// ServerCapabilities describes provider capabilities
message ServerCapabilities {
    bool plan_destroy = 1;
    bool get_provider_schema_optional = 2;
    bool move_resource_state = 3;
}

// GetProviderSchema
message GetProviderSchema {
    message Request {
    }
    message Response {
        Schema provider = 1;
        map<string, Schema> resource_schemas = 2;
        map<string, Schema> data_source_schemas = 3;
        repeated Diagnostic diagnostics = 4;
        Schema provider_meta = 5;
        ServerCapabilities server_capabilities = 6;
        map<string, Function> functions = 7;
    }
}

// ValidateProviderConfig
message ValidateProviderConfig {
    message Request {
        DynamicValue config = 1;
    }
    message Response {
        repeated Diagnostic diagnostics = 1;
    }
}

// ValidateResourceConfig
message ValidateResourceConfig {
    message Request {
        string type_name = 1;
        DynamicValue config = 2;
    }
    message Response {
        repeated Diagnostic diagnostics = 1;
    }
}

// ValidateDataResourceConfig
message ValidateDataResourceConfig {
    message Request {
        string type_name = 1;
        DynamicValue config = 2;
    }
    message Response {
        repeated Diagnostic diagnostics = 1;
    }
}

// UpgradeResourceState
message UpgradeResourceState {
    message Request {
        string type_name = 1;
        int64 version = 2;
        RawState raw_state = 3;
    }
    message Response {
        DynamicValue upgraded_state = 1;
        repeated Diagnostic diagnostics = 2;
    }
}

// ConfigureProvider
message ConfigureProvider {
    message Request {
        string terraform_version = 1;
        DynamicValue config = 2;
    }
    message Response {
        repeated Diagnostic diagnostics = 1;
    }
}

// ReadResource
message ReadResource {
    message Request {
        string type_name = 1;
        DynamicValue current_state = 2;
        bytes private = 3;
        DynamicValue provider_meta = 4;
    }
    message Response {
        DynamicValue new_state = 1;
        repeated Diagnostic diagnostics = 2;
        bytes private = 3;
        Deferred deferred = 4;
    }
}

// PlanResourceChange
message PlanResourceChange {
    message Request {
        string type_name = 1;
        DynamicValue prior_state = 2;
        DynamicValue proposed_new_state = 3;
        DynamicValue config = 4;
        bytes prior_private = 5;
        DynamicValue provider_meta = 6;
    }
    message Response {
        DynamicValue planned_state = 1;
        repeated AttributePath requires_replace = 2;
        bytes planned_private = 3;
        repeated Diagnostic diagnostics = 4;
        bool legacy_type_system = 5;
        Deferred deferred = 6;
    }
}

// ApplyResourceChange
message ApplyResourceChange {
    message Request {
        string type_name = 1;
        DynamicValue prior_state = 2;
        DynamicValue planned_state = 3;
        DynamicValue config = 4;
        bytes planned_private = 5;
        DynamicValue provider_meta = 6;
    }
    message Response {
        DynamicValue new_state = 1;
        bytes private = 2;
        repeated Diagnostic diagnostics = 3;
        bool legacy_type_system = 4;
    }
}

// ImportResourceState
message ImportResourceState {
    message Request {
        string type_name = 1;
        string id = 2;
    }
    message ImportedResource {
        string type_name = 1;
        DynamicValue state = 2;
        bytes private = 3;
    }
    message Response {
        repeated ImportedResource imported_resources = 1;
        repeated Diagnostic diagnostics = 2;
        Deferred deferred = 3;
    }
}

// MoveResourceState
message MoveResourceState {
    message Request {
        string source_provider_address = 1;
        string source_type_name = 2;
        int64 source_schema_version = 3;
        RawState source_state = 4;
        string target_type_name = 5;
        bytes source_private = 6;
    }
    message Response {
        DynamicValue target_state = 1;
        repeated Diagnostic diagnostics = 2;
    }
}

// ReadDataSource
message ReadDataSource {
    message Request {
        string type_name = 1;
        DynamicValue config = 2;
        DynamicValue provider_meta = 3;
    }
    message Response {
        DynamicValue state = 1;
        repeated Diagnostic diagnostics = 2;
        Deferred deferred = 3;
    }
}

// GetFunctions
message GetFunctions {
    message Request {
    }
    message Response {
        map<string, Function> functions = 1;
        repeated Diagnostic diagnostics = 2;
    }
}

// CallFunction
message CallFunction {
    message Request {
        string name = 1;
        repeated DynamicValue arguments = 2;
    }
    message Response {
        DynamicValue result = 1;
        FunctionError error = 2;
    }
}

// FunctionError
message FunctionError {
    string text = 1;
    int64 function_argument = 2;
}

// Provider service
service Provider {
    rpc GetProviderSchema(GetProviderSchema.Request) returns (GetProviderSchema.Response);
    rpc ValidateProviderConfig(ValidateProviderConfig.Request) returns (ValidateProviderConfig.Response);
    rpc ValidateResourceConfig(ValidateResourceConfig.Request) returns (ValidateResourceConfig.Response);
    rpc ValidateDataResourceConfig(ValidateDataResourceConfig.Request) returns (ValidateDataResourceConfig.Response);
    rpc UpgradeResourceState(UpgradeResourceState.Request) returns (UpgradeResourceState.Response);
    rpc ConfigureProvider(ConfigureProvider.Request) returns (ConfigureProvider.Response);
    rpc ReadResource(ReadResource.Request) returns (ReadResource.Response);
    rpc PlanResourceChange(PlanResourceChange.Request) returns (PlanResourceChange.Response);
    rpc ApplyResourceChange(ApplyResourceChange.Request) returns (ApplyResourceChange.Response);
    rpc ImportResourceState(ImportResourceState.Request) returns (ImportResourceState.Response);
    rpc MoveResourceState(MoveResourceState.Request) returns (MoveResourceState.Response);
    rpc ReadDataSource(ReadDataSource.Request) returns (ReadDataSource.Response);
    rpc GetFunctions(GetFunctions.Request) returns (GetFunctions.Response);
    rpc CallFunction(CallFunction.Request) returns (CallFunction.Response);
    rpc StopProvider(StopProvider.Request) returns (StopProvider.Response);
}
